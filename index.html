<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bao Bao's Bakery Quest</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Basic styling for demonstration */
      body {
        font-family: 'Fredoka', sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
      }
      header {
        background: #fbd14b;
        padding: 20px;
        text-align: center;
      }
      nav a {
        margin: 0 15px;
        color: #333;
        font-weight: 600;
        text-decoration: none;
      }
      main {
        padding: 20px;
        max-width: 800px;
        margin: auto;
      }
      .action-btn {
        background: #fbd14b;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 5px;
      }
      .dev {
        background: #e74c3c;
        color: #fff;
      }
      #video-container {
        margin: 20px auto;
      }
      #video-overlay {
        background: rgba(0,0,0,0.5);
      }
    </style>
    <!-- NOTE: We are using the native FaceDetector API which is currently supported in Chrome and Edge.
         Make sure you are running the latest version of one of these browsers.
         For browsers that do not support this API, the code will simulate face detection. -->
  </head>
  <body>
    <header>
      <h1>Bao Bao‚Äôs Bakery Quest</h1>
      <nav>
        <a href="#concept">Concept</a>
        <a href="#how-it-works">How It Works</a>
        <a href="#rewards">Reward System</a>
        <a href="#implementation">Implementation</a>
        <a href="#about">About</a>
      </nav>
    </header>
    <main>
      <section id="concept">
        <h2>Concept</h2>
        <p>
          Embark on a fun journey with Bao Bao! Earn "Golden Pastry Points" with every purchase,
          level up your character, and unlock exclusive rewards along the way.
        </p>
      </section>
      <section id="character-progress">
        <h2>Your Bao Bao Progress</h2>
        <div id="character-stage">
          <img id="character-img" src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Character Stage" width="150" style="border-radius:50%;" />
          <p id="character-title">Stage: Baby Chick</p>
          <p id="points-display">Points: 0</p>
          <!-- Valid sample code: CAFE2025APR08 -->
          <button id="code-entry-btn" class="action-btn">Enter Today's Visit Code</button>
          <button id="scan-btn" class="action-btn">Scan with Camera (Face + Smile)</button>
          <button id="dev-btn" class="action-btn dev">Dev: Add 50 Points</button>
        </div>
        <!-- Video container for scanning -->
        <div id="video-container" style="position:relative; display:none; width:300px; margin:auto;">
          <video id="video-stream" style="width:300px;" autoplay muted></video>
          <div id="video-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:1.2rem; text-align:center; color:#fff;">
            <!-- Overlay text will be inserted here -->
          </div>
        </div>
      </section>
      <section id="how-it-works">
        <h2>How It Works</h2>
        <ul>
          <li><strong>Code Entry & Scan:</strong> Enter a daily visit code or use your camera to verify your face and smile for points!</li>
          <li><strong>Level Up:</strong> Watch your character evolve as you gain points</li>
          <li><strong>Mini Games:</strong> Enjoy simple in-app games for bonus rewards</li>
          <li><strong>Bao Bao Surprises:</strong> Receive tips and surprise gifts from Bao Bao</li>
        </ul>
      </section>
      <section id="rewards">
        <h2>Reward System</h2>
        <table border="1" cellspacing="0" cellpadding="5">
          <thead>
            <tr>
              <th>Tier</th>
              <th>Points Needed</th>
              <th>Reward</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>üç™ Pastry Apprentice</td>
              <td>50 pts</td>
              <td>Free mini pastry</td>
            </tr>
            <tr>
              <td>üé© Dough Master</td>
              <td>150 pts</td>
              <td>Exclusive Bao Bao sticker</td>
            </tr>
            <tr>
              <td>ü•Æ Golden Baker</td>
              <td>300 pts</td>
              <td>10% off next purchase</td>
            </tr>
            <tr>
              <td>‚≠ê Master Baker</td>
              <td>500 pts</td>
              <td>Limited-edition Hang Heung gift üéÅ</td>
            </tr>
          </tbody>
        </table>
        <h3>Bonus Rewards</h3>
        <ul>
          <li>Surprise Birthday Gift</li>
          <li>Referral Rewards: Invite a friend for bonus points!</li>
          <li>Bao Bao‚Äôs Challenge: Limited-time seasonal challenges</li>
        </ul>
      </section>
      <section id="implementation">
        <h2>Implementation</h2>
        <ul>
          <li>No app download required! Works via WeChat, WhatsApp, or Web QR Code</li>
          <li>Quick Scan System: Use code entry or camera scan; the system detects your face then your smile to award points.</li>
          <li>All points are stored digitally</li>
          <li>A real-time dashboard shows your points and level</li>
        </ul>
      </section>
      <section id="about">
        <h2>About</h2>
        <p>
          Bao Bao‚Äôs Bakery Quest is a cafe loyalty program designed to reward customers with fun challenges and prizes.
        </p>
        <p>Developed by Kuanysh with love and pastries üßÅ</p>
      </section>
    </main>
    <footer>
      <p>&copy; 2025 Bao Bao‚Äôs Bakery Quest. All rights reserved.</p>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        console.log("DOM loaded.");
        let points = 0;
        const stages = [
          { min: 0, title: "Baby Chick", img: "https://cdn-icons-png.flaticon.com/512/616/616408.png" },
          { min: 50, title: "Bao Bao Dumpling", img: "https://cdn-icons-png.flaticon.com/512/9711/9711938.png" },
          { min: 150, title: "Junior Chef", img: "https://cdn-icons-png.flaticon.com/512/135/135620.png" },
          { min: 300, title: "Golden Baker", img: "https://cdn-icons-png.flaticon.com/512/706/706164.png" },
          { min: 500, title: "Master Bao Bao", img: "https://cdn-icons-png.flaticon.com/512/1828/1828884.png" }
        ];

        const pointsDisplay = document.getElementById("points-display");
        const characterImg = document.getElementById("character-img");
        const characterTitle = document.getElementById("character-title");
        const codeEntryBtn = document.getElementById("code-entry-btn");
        const scanBtn = document.getElementById("scan-btn");
        const devBtn = document.getElementById("dev-btn");
        const videoContainer = document.getElementById("video-container");
        const videoElem = document.getElementById("video-stream");
        const overlay = document.getElementById("video-overlay");

        function updateCharacter() {
          for (let i = stages.length - 1; i >= 0; i--) {
            if (points >= stages[i].min) {
              characterImg.src = stages[i].img;
              characterTitle.textContent = "Stage: " + stages[i].title;
              break;
            }
          }
          pointsDisplay.textContent = "Points: " + points;
          console.log("Points updated:", points);
        }

        function addPoints(value) {
          points += value;
          updateCharacter();
        }

        // Code Entry Button Logic
        codeEntryBtn.addEventListener("click", function () {
          console.log("Code Entry clicked.");
          // Sample valid code is "CAFE2025APR08"
          let code = prompt("Enter today's cafe visit code (e.g., CAFE2025APR08):");
          if (code && code.trim() === "CAFE2025APR08") {
            addPoints(10);
            alert("Valid code! 10 points awarded.");
          } else {
            alert("Invalid code. Please try again with a valid code.");
          }
        });

        // Developer Button Logic
        devBtn.addEventListener("click", function () {
          console.log("Dev button clicked.");
          addPoints(50);
          alert("Dev: 50 points added.");
        });

        // Scan Button Logic using the native FaceDetector API
        scanBtn.addEventListener("click", async function () {
          console.log("Scan button clicked.");
          videoContainer.style.display = "block";
          overlay.textContent = "Initializing camera...";
          try {
            // Request video stream
            const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
            videoElem.srcObject = stream;
            await videoElem.play();
            overlay.textContent = "Detecting face...";
            // Start face detection using the native FaceDetector API if available
            detectionStage1();
          } catch (err) {
            console.error("Camera error:", err);
            overlay.textContent = "Camera access error.";
          }
        });

        async function detectionStage1() {
          // Use the native FaceDetector API if available.
          if ("FaceDetector" in window) {
            const detector = new FaceDetector({ maxDetectedFaces: 1, fastMode: true });
            let startTime = Date.now();
            const interval = setInterval(async () => {
              try {
                const faces = await detector.detect(videoElem);
                if (faces.length > 0) {
                  clearInterval(interval);
                  console.log("Face detected via FaceDetector:", faces);
                  overlay.textContent = "Face detected! Now, please smile.";
                  setTimeout(detectionStage2, 500);
                } else if (Date.now() - startTime > 3000) {
                  clearInterval(interval);
                  console.log("Forcing pass: no face detected in 3 seconds.");
                  overlay.textContent = "Face recognized by force! Now, please smile.";
                  setTimeout(detectionStage2, 500);
                }
              } catch (error) {
                console.error("Face detection error:", error);
                clearInterval(interval);
                // Fallback: force pass if error occurs.
                overlay.textContent = "Face recognized by force! Now, please smile.";
                setTimeout(detectionStage2, 500);
              }
            }, 300);
          } else {
            // Fallback if FaceDetector API is not available.
            console.log("FaceDetector API not available. Forcing face detection pass.");
            overlay.textContent = "Face recognized by fallback! Now, please smile.";
            setTimeout(detectionStage2, 500);
          }
        }

        async function detectionStage2() {
          // Since the native FaceDetector API doesn't do expression analysis, simulate smile detection.
          // In a production system, you might integrate a more advanced ML model for smile recognition.
          overlay.textContent = "Please smile! (Simulated detection)";
          // Wait 3 seconds to simulate smile detection.
          setTimeout(() => {
            console.log("Smile detected via simulation.");
            overlay.textContent = "Smile recognized! 10 points awarded.";
            addPoints(10);
            setTimeout(finishDetection, 1000);
          }, 3000);
        }

        function finishDetection() {
          const stream = videoElem.srcObject;
          if (stream) {
            stream.getTracks().forEach((track) => track.stop());
            console.log("Camera stream stopped.");
          }
          setTimeout(() => {
            videoContainer.style.display = "none";
            overlay.textContent = "";
            console.log("Detection cycle finished.");
          }, 1000);
        }

        updateCharacter();
      });
    </script>
  </body>


  
</html>

